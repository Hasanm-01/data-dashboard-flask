const form = document.getElementById("uform");
const summaryEl = document.getElementById("summary");
const previewEl = document.getElementById("preview");
let chart;

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  const fd = new FormData(form);
  const res = await fetch("/upload", { method: "POST", body: fd });
  const json = await res.json();
  if (json.error) { summaryEl.textContent = json.error; return; }
  const { summary, preview } = json;
  summaryEl.textContent = JSON.stringify(summary, null, 2);
  previewEl.textContent = JSON.stringify(preview, null, 2);
  if (summary.numericSummary && preview.length) {
    const col = summary.numericSummary.column;
    const labels = preview.map((_, i) => i + 1);
    const data = preview.map(r => Number(r[col] ?? 0));
    const ctx = document.getElementById("chart").getContext("2d");
    if (chart) chart.destroy();
    chart = new Chart(ctx, { type: "bar",
      data: { labels, datasets: [{ label: col, data }] },
      options: { responsive: true } });
  }
});
